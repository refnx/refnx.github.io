
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Getting started &#8212; refnx 0.0.13.dev0+ documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.13.dev0+',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<span id="gettingstarted-chapter"></span><h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="fitting-a-neutron-reflectometry-dataset">
<h2>Fitting a neutron reflectometry dataset<a class="headerlink" href="#fitting-a-neutron-reflectometry-dataset" title="Permalink to this headline">¶</a></h2>
<p>This example analyses a neutron reflectometry dataset, you can find this
example on <a class="reference external" href="https://github.com/refnx/refnx/blob/master/examples/reflectometry_analysis.ipynb">Github</a>. Start off with relevant imports:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">refnx.analysis</span> <span class="k">import</span> <span class="n">Objective</span><span class="p">,</span> <span class="n">CurveFitter</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Transform</span>
<span class="kn">from</span> <span class="nn">refnx.analysis</span> <span class="k">import</span> <span class="n">process_chain</span>
<span class="kn">from</span> <span class="nn">refnx.reflect</span> <span class="k">import</span> <span class="n">Slab</span><span class="p">,</span> <span class="n">SLD</span><span class="p">,</span> <span class="n">ReflectModel</span>
<span class="kn">from</span> <span class="nn">refnx.dataset</span> <span class="k">import</span> <span class="n">ReflectDataset</span>
</pre></div>
</div>
<p>Load some data</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">ReflectDataset</span><span class="p">(</span><span class="s1">&#39;c_PLP0011859_q.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Set up the SLD’s for the model</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">si</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="mf">2.07</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Si&#39;</span><span class="p">)</span>
<span class="n">sio2</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="mf">3.47</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SiO2&#39;</span><span class="p">)</span>
<span class="n">film</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;film&#39;</span><span class="p">)</span>
<span class="n">d2o</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="mf">6.36</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;d2o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Create some slabs. The sio2 oxide layer is 30 Å thick with a 3 Å roughness.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">sio2_layer</span> <span class="o">=</span> <span class="n">sio2</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">sio2_layer</span><span class="o">.</span><span class="n">thick</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sio2_layer</span><span class="o">.</span><span class="n">rough</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">film_layer</span> <span class="o">=</span> <span class="n">film</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">film_layer</span><span class="o">.</span><span class="n">thick</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">film_layer</span><span class="o">.</span><span class="n">sld</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">film_layer</span><span class="o">.</span><span class="n">rough</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">d2o_layer</span> <span class="o">=</span> <span class="n">d2o</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">d2o_layer</span><span class="o">.</span><span class="n">rough</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
</pre></div>
</div>
<p>Make a Structure from Slab components</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">structure</span> <span class="o">=</span> <span class="n">si</span> <span class="o">|</span> <span class="n">sio2_layer</span> <span class="o">|</span> <span class="n">film_layer</span> <span class="o">|</span> <span class="n">d2o_layer</span>
</pre></div>
</div>
<p>Setup a reflectivity model from the structure</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ReflectModel</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">bkg</span><span class="o">=</span><span class="mf">3e-6</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">bkg</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">9e-6</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>An Objective requires a Model and a Data1D object. The transform kwd says that
we want to fit as logY vs X. Lets also plot it (requires matplotlib be
installed).</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">Transform</span><span class="p">(</span><span class="s1">&#39;logY&#39;</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/c_PLP0011859_q.png" src="_images/c_PLP0011859_q.png" />
<p>Once we have an Objective we can create a CurveFitter. Do a quick fit with the
‘differential_evolution’ solver.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">fitter</span> <span class="o">=</span> <span class="n">CurveFitter</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s1">&#39;differential_evolution&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now lets do some MCMC sampling with the CurveFitter object.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">fitter</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>Before we can use the results we have to burn and thin to reduce correlation.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">process_chain</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">fitter</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span> <span class="n">nburn</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">nthin</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>Look at the parameters and plot again.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/fitted_c_PLP0011859_q.png" src="_images/fitted_c_PLP0011859_q.png" />
<p>Visualise the covariance with a corner plot (requires the corner package be
installed)</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>
<span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">fitter</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">flatchain</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/corner_c_PLP0011859_q.png" src="_images/corner_c_PLP0011859_q.png" />
</div>
<div class="section" id="fitting-a-data-to-a-user-defined-model">
<h2>Fitting a data to a user defined model<a class="headerlink" href="#fitting-a-data-to-a-user-defined-model" title="Permalink to this headline">¶</a></h2>
<p>Here we demonstrate a fit to a user defined model. This line example is taken
from the <a class="reference external" href="http://emcee.readthedocs.io/en/stable/user/line.html">emcee documentation</a> and the reader is referred to that link for
more detailed explanation. The errorbars are underestimated, and the modelling
will account for that.</p>
<p>Synthesise data:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>

<span class="c1"># Choose the &quot;true&quot; parameters.</span>
<span class="n">m_true</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.9594</span>
<span class="n">b_true</span> <span class="o">=</span> <span class="mf">4.294</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="mf">0.534</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">yerr</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">m_true</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b_true</span>
<span class="n">y</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_true</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">y</span> <span class="o">+=</span> <span class="n">yerr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>To use <em>refnx</em> we need first need to create a dataset.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">refnx.dataset</span> <span class="k">import</span> <span class="n">Data1D</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Data1D</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">))</span>
</pre></div>
</div>
<p>Then we need to set up a generative model.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">refnx.analysis</span> <span class="k">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">Objective</span><span class="p">,</span> <span class="n">Parameter</span>

<span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="n">p_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">p_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># the model needs parameters</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">p</span> <span class="o">|=</span> <span class="n">Parameter</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fitfunc</span><span class="o">=</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we create an objective from the mode and the data. We use an extra
parameter, lnsigma, to describe the underestimated error bars.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">lnf</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;lnf&#39;</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">lnsigma</span><span class="o">=</span><span class="n">lnf</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally a CurveFitter.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">refnx.analysis</span> <span class="k">import</span> <span class="n">CurveFitter</span><span class="p">,</span> <span class="n">process_chain</span>
<span class="n">fitter</span> <span class="o">=</span> <span class="n">CurveFitter</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>

<span class="c1"># get max likelihood</span>
<span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s1">&#39;differential_evolution&#39;</span><span class="p">)</span>

<span class="c1"># sample</span>
<span class="n">fitter</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># burn the first 100, and thin by 15.</span>
<span class="n">process_chain</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">fitter</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span> <span class="n">nburn</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">nthin</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">flatchain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">________________________________________________________________________________</span>
<span class="n">Objective</span> <span class="o">-</span> <span class="mi">111850645096</span>
<span class="n">Dataset</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">refnx</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">data1d</span><span class="o">.</span><span class="n">Data1D</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10796ef60</span><span class="o">&gt;</span>
<span class="n">datapoints</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">chi2</span> <span class="o">=</span> <span class="mf">45.03473215559118</span>
<span class="n">Weighted</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">Transform</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">________________________________________________________________________________</span>
<span class="n">Parameters</span><span class="p">:</span>      <span class="kc">None</span>
<span class="o">&lt;</span><span class="n">Parameter</span><span class="p">:</span>     <span class="s1">&#39;lnf&#39;</span>     <span class="n">value</span><span class="o">=</span>   <span class="o">-</span><span class="mf">0.769326</span>    <span class="o">+/-</span> <span class="mf">0.156</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span>
<span class="n">________________________________________________________________________________</span>
<span class="n">Parameters</span><span class="p">:</span>      <span class="kc">None</span>
<span class="o">&lt;</span><span class="n">Parameter</span><span class="p">:</span>      <span class="s1">&#39;b&#39;</span>      <span class="n">value</span><span class="o">=</span>    <span class="mf">4.5473</span>      <span class="o">+/-</span> <span class="mf">0.36</span> <span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">Parameter</span><span class="p">:</span>      <span class="s1">&#39;m&#39;</span>      <span class="n">value</span><span class="o">=</span>   <span class="o">-</span><span class="mf">1.00738</span>     <span class="o">+/-</span> <span class="mf">0.0788</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here’s the data. The true model is shown, along with the model from the median
of the MCMC parameters, 500 samples from the MCMC chain, and the linear least
squares fit. Note how close the median MCMC estimated model is to the ‘true’
behaviour. See how far off the linear least squares fit is, if you don’t take
into account the underestimated error bars.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># get the least squares fit</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">yerr</span> <span class="o">*</span> <span class="n">yerr</span><span class="p">)</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">A</span><span class="p">)))</span>
<span class="n">b_ls</span><span class="p">,</span> <span class="n">m_ls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">xl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="k">for</span> <span class="n">lnf</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">objective</span><span class="o">.</span><span class="n">pgen</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">xl</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">model</span><span class="p">(</span><span class="n">xl</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;MCMC median&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">model</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="p">[</span><span class="n">b_ls</span><span class="p">,</span> <span class="n">m_ls</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;linear least squares&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">m_true</span><span class="o">*</span><span class="n">xl</span><span class="o">+</span><span class="n">b_true</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/line_fit.png" src="_images/line_fit.png" />
<p>Here’s a corner plot of the results</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;log(f)&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">fitter</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">flatchain</span><span class="p">,</span>
                    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                    <span class="n">truths</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f_true</span><span class="p">),</span> <span class="n">b_true</span><span class="p">,</span> <span class="n">m_true</span><span class="p">]);</span>
</pre></div>
</div>
<img alt="_images/corner_line.png" src="_images/corner_line.png" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting started</a><ul>
<li><a class="reference internal" href="#fitting-a-neutron-reflectometry-dataset">Fitting a neutron reflectometry dataset</a></li>
<li><a class="reference internal" href="#fitting-a-data-to-a-user-defined-model">Fitting a data to a user defined model</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="faq.html" title="next chapter">Frequently Asked Questions</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/gettingstarted.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015-2017, Andrew Nelson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/gettingstarted.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>